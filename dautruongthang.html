<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đấu Trường Tháng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background-color: #f8f9fa;
            margin: 0;
              -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
             padding: 0.5rem 1rem;
           background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
          .profile-header {
            cursor: pointer;
            position: relative;
            display: inline-block;
             background-color: white;
            padding: 8px 15px;
             border-radius: 5px;
           box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }
        .profile-header i {
            color: #3498db;
         }
        .profile-header:hover {
            background-color: #e0f7f5;
        }
         .profile-header:hover i {
            color: #2980b9;
       }
        .profile-popup {
           position: absolute;
           top: 100%;
           right: 0;
            background: white;
            padding: 15px;
            border: 1px solid #ccc;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
           z-index: 1000;
           display: none;
            border-radius: 5px;
      }
       .profile-popup.active {
            display: block;
        }
         .profile-popup ul {
           list-style: none;
           padding: 0;
      }
        .profile-popup li {
           padding: 8px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
           transition: background-color 0.3s;
       }
       .profile-popup li:hover {
          background-color: #f8f9fa;
        }
       .profile-popup li:last-child {
          border-bottom: none;
       }
        #preloader {
            position: fixed;
             top: 0;
           left: 0;
           width: 100%;
           height: 100%;
            background: rgba(255, 255, 255, 0.9); /* Slightly transparent white background */
           display: flex;
           flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000; /* Ensure preloader is on top */
           transition: opacity 0.5s ease;
       }
       #preloader.hide {
           opacity: 0;
            pointer-events: none;
        }
         #preloader img {
             max-width: 300px;
            margin-bottom: 20px;
        }
       .month-list-container{
            margin-top: 20px;
           padding: 20px;
        }
      .month-item {
           background-color: #fff;
           border-radius: 10px;
           box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
           padding: 15px;
            cursor: pointer;
          transition: transform 0.2s, box-shadow 0.2s;
         
        }
         .month-item:hover {
            transform: translateY(-3px);
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .month-item h3{
             font-size: 1.3rem;
             margin-bottom: 10px;
        }
        .month-item .action-button {
            background-color: #3498db;
             color: white;
             border: none;
             padding: 8px 16px;
            border-radius: 5px;
              cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1rem;
          white-space: nowrap; /* Prevent text wrapping */
       }
      .month-item .action-button:hover {
            background-color: #2980b9;
       }
        .month-item .registration-message {
           margin-top: 10px;
            font-style: italic;
           color: #555;
        }
         #registration-popup{
            position: fixed;
              top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
             padding: 20px;
           border: 1px solid #ccc;
             box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
             display: none;
              max-height: 90vh;
             overflow-y: auto;
             border-radius: 10px;
            width: 600px;
       }
        #registration-popup.active {
           display: block;
         }
         #registration-popup .popup-content{
           padding: 20px;
       }
        #registration-popup .popup-content h3{
            margin-bottom: 20px;
       }
       #registration-popup .popup-content .form-group {
            margin-bottom: 15px;
       }
         #registration-popup .popup-content .form-group label{
          display: block;
          margin-bottom: 5px;
             font-weight: bold;
        }
          #registration-popup .popup-content .form-group input,
         #registration-popup .popup-content .form-group select {
             width: 100%;
           padding: 10px;
           border: 1px solid #ccc;
            border-radius: 5px;
       }
        #registration-popup .popup-content .form-group button {
             background-color: #3498db;
          color: white;
          border: none;
            padding: 10px 16px;
            border-radius: 5px;
          cursor: pointer;
            transition: background-color 0.3s;
       }
       #registration-popup .popup-content .form-group button:hover {
           background-color: #2980b9;
       }
        #registration-popup .btn-close {
            position: absolute;
              top: 10px;
             right: 10px;
           background-image: url('https://media.istockphoto.com/id/1131230925/vi/vec-to/d%E1%BA%A5u-ki%E1%BB%83m-bi%E1%BB%83u-t%C6%B0%E1%BB%A3ng-ch%E1%BB%AF-th%E1%BA%ADp-%C4%91%E1%BB%8F-%C4%91%C6%A1n-gi%E1%BA%A3n-vector.jpg?s=612x612&w=0&k=20&c=Zl4pvbt2-7JoQCohB1JdIf2JKS-BoHbhQGNhmhwaiSA=');
           background-size: contain;
            width: 24px;
            height: 24px;
            cursor: pointer;
             border: 0;
           background-repeat: no-repeat;
       }
       .nav-links {
        display: flex;
        align-items: center;
        justify-content: space-around; /* Đặt các liên kết đều nhau */
         flex-wrap: wrap; /* Cho phép xuống dòng khi màn hình nhỏ */
    }
      .nav-links a {
        display: flex;
         flex-direction: column; /* Stack icon và text dọc */
        align-items: center;
         color: #333;
        text-decoration: none;
        margin-right: 10px; /* Giảm margin phải */
        margin-bottom: 5px; /* Thêm margin dưới cho responsive */
         padding: 8px 12px;
         border-radius: 5px;
         transition: background-color 0.3s;
          text-align: center; /* Center text */
    }
     .nav-links a:hover {
       background-color: #e0f7f5;
      }
     .nav-links i {
         margin-bottom: 5px; /* Thêm margin dưới cho icon */
          font-size: 1.5em; /* Lớn hơn một chút cho dễ nhìn */
         transition: color 0.3s; /* Thêm hiệu ứng chuyển màu */
     }
     .nav-links a:hover i {
        color: #2980b9;
     }
    @media (min-width: 768px) {
       .nav-links {
           justify-content: flex-start; /* Các liên kết sang trái trên màn hình lớn hơn */
         }
      .nav-links a {
        flex-direction: row;
         margin-right: 20px;
          text-align: left;
        align-items: center;
       }
        .nav-links i{
           margin-right: 5px;
          margin-bottom: 0;
          font-size: 1em;
        }
   }
    </style>
</head>
<body>
    <div id="preloader">
        <img src="https://cdn.pixabay.com/animation/2023/11/09/03/05/03-05-45-320_512.gif" alt="Loading...">
    </div>
    <div class="container-fluid" id="content" style="display: none;">
         <div class="header-container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <div class="nav-links">
                        <a href="vaohoc.html">
                            <i class="fas fa-book" style="color: #3498db;"></i> <span>Vào học</span>
                        </a>
                        <a href="luyenthi.html">
                            <i class="fas fa-pencil-alt" style="color: #e67e22;"></i> <span>Luyện thi</span>
                        </a>
                         <a href="dautruong.html">
                            <i class="fas fa-gamepad" style="color: #9b59b6;"></i> <span>Đấu trường</span>
                         </a>
                         <a href="trangcanhan.html">
                           <i class="fas fa-trophy" style="color: #27ae60;"></i> <span>Vào thi</span>
                        </a>
                     </div>
              </div>
        </nav>
            <div class="d-flex align-items-center">
                <div class="profile-header">
                   <i class="fa fa-user-circle me-2"></i> <span id="header-fullname"></span>
                    <div class="profile-popup">
                        <ul class="profile-popup-menu">
                            <li id="info-menu">Thông tin cá nhân</li>
                             <li id="change-password-menu">Đổi mật khẩu</li>
                            <li id="logout-menu">Đăng xuất</li>
                       </ul>
                    </div>
              </div>
            </div>
         </div>
        <div class="month-list-container" id="month-list">
            <!-- Danh sách vòng thi sẽ được tạo bằng JS -->
        </div>
   </div>
 <div id="registration-popup" class="popup">
       <div class="popup-content">
              <button type="button" class="btn-close" aria-label="Close"></button>
             <h3>Đăng Ký Đấu Trường</h3>
           <form id="registration-form">
                  <div class="form-group">
                     <label for="fullname">Họ và tên</label>
                     <input type="text" id="fullname" required>
                  </div>
                  <div class="form-group">
                       <label for="username">Tên đăng nhập</label>
                     <input type="text" id="username" required>
                  </div>
                   <div class="form-group">
                      <label for="grade">Khối</label>
                     <select id="grade" class="form-control">
                              <option value="6">6</option>
                             <option value="7">7</option>
                             <option value="8">8</option>
                               <option value="9">9</option>
                      </select>
                  </div>
               <div class="form-group">
                     <label for="school">Trường</label>
                    <input type="text" id="school" required>
                  </div>
                  <div class="form-group">
                      <button type="submit">Đăng ký</button>
                 </div>
            </form>
       </div>
 </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
       const preloader = document.getElementById('preloader');
        const content = document.getElementById('content');
       const monthListContainer = document.getElementById('month-list');
        const registrationPopup = document.getElementById('registration-popup');
          const registrationForm = document.getElementById('registration-form');
           const profileHeader = document.querySelector('.profile-header');
         const profilePopup = document.querySelector('.profile-popup');
          const logoutMenu = document.getElementById('logout-menu');
        const headerFullname = document.querySelector('#header-fullname');
          
        const loginTime = localStorage.getItem('loginTime');
         const currentTime = new Date().getTime();
         if (!loginTime || (currentTime - parseInt(loginTime)) > 24 * 60 * 60 * 1000) {
            localStorage.removeItem('user');
             localStorage.removeItem('loginTime');
           window.location.href = 'dangnhap.html';
         }
         const storedUser = localStorage.getItem('user');
         let user;
       if (storedUser) {
           user = JSON.parse(storedUser);
        } else {
            window.location.href = 'dangnhap.html';
        }
        headerFullname.textContent = user.fullname;
         function closeAllPopup() {
             registrationPopup.classList.remove('active');
         }
      document.querySelectorAll('.popup .btn-close').forEach(closeButton => {
         closeButton.addEventListener('click', closeAllPopup);
     });
         function toggleProfilePopup() {
        profilePopup.classList.toggle('active');
        if(profilePopup.classList.contains('active')){
           document.addEventListener('click',function(event){
           if (!profileHeader.contains(event.target)) {
                profilePopup.classList.remove('active');
               document.removeEventListener('click', arguments.callee);
           }
         });
      }
  
    }
     profileHeader.addEventListener('click', toggleProfilePopup);
     // Xử lý nút đăng xuất
    logoutMenu.addEventListener('click', function () {
         profilePopup.classList.remove('active');
        localStorage.removeItem('user');
       localStorage.removeItem('loginTime');
       window.location.href = 'dangnhap.html';
  });
        function simulateLoading() {
            setTimeout(() => {
                preloader.classList.add('hide');
              content.style.display = 'block';
            }, 1000);
       }
        simulateLoading();
       const months = [
        { id: 1, name: 'Đấu trường tháng 10' },
           { id: 2, name: 'Đấu trường tháng 12' },
           { id: 3, name: 'Đấu trường tháng 2' },
         { id: 4, name: 'Đấu trường tháng 4' }
       ];
        let registrations = JSON.parse(localStorage.getItem('registrations') || '[]');
       function renderMonthList() {
         monthListContainer.innerHTML = '';
           months.forEach(month => {
            const monthItem = document.createElement('div');
             monthItem.classList.add('month-item');
             monthItem.innerHTML = `<h3>${month.name}</h3>
                <div id="action-${month.id}">
               </div>
           `;
             monthListContainer.appendChild(monthItem);
             const actionContainer = document.getElementById(`action-${month.id}`);
            const registration = registrations.find(reg => reg.monthId === month.id && reg.username === user.username);
             if (!registration) {
                 const registerButton = document.createElement('button');
                  registerButton.classList.add('action-button');
                registerButton.textContent = 'Vui lòng đăng ký tại đây';
                 registerButton.addEventListener('click', () => {
                      registrationPopup.classList.add('active');
                     registrationForm.dataset.monthId = month.id
                });
                const registrationMessage = document.createElement('p');
                   registrationMessage.classList.add('registration-message');
                  registrationMessage.textContent = 'Bạn chưa đăng ký đấu trường.';
                  actionContainer.appendChild(registrationMessage)
                  actionContainer.appendChild(registerButton);
            }
           else if(registration.status === 'pending')
            {
                 const registrationMessage = document.createElement('p');
                  registrationMessage.classList.add('registration-message');
                  registrationMessage.textContent = 'Đang chờ xác thực';
                 actionContainer.appendChild(registrationMessage)
           }else if(registration.status === 'approved') {
                 const joinButton = document.createElement('a');
                  joinButton.classList.add('action-button')
                  joinButton.textContent = 'Tham gia';
                   joinButton.href = 'https://meet.google.com/uce-diza-btu';
                   actionContainer.appendChild(joinButton);
           }
         });
       }
        renderMonthList();
        registrationForm.addEventListener('submit', function(e) {
           e.preventDefault();
           const monthId = parseInt(registrationForm.dataset.monthId)
           const fullname = document.getElementById('fullname').value;
          const username = document.getElementById('username').value;
           const grade = document.getElementById('grade').value;
            const school = document.getElementById('school').value;
             const newRegistration = {
                 monthId: monthId,
              fullname: fullname,
                username: username,
              grade: grade,
                school: school,
              status: 'pending'
           };
            registrations.push(newRegistration);
          localStorage.setItem('registrations', JSON.stringify(registrations));
             registrationForm.reset();
           registrationPopup.classList.remove('active');
            renderMonthList();
           alert("Đăng ký thành công! Vui lòng chờ xác thực.");
       });
     document.addEventListener('contextmenu', function (e) {
           e.preventDefault();
       });
       document.addEventListener('keydown', function(e){
          if ((e.ctrlKey && (e.key === 'c' || e.key === 'u' || e.key === 'a'|| e.key === 'x')) || e.key === 'F12') {
             e.preventDefault();
           }
      });
  </script>
</body>
</html>